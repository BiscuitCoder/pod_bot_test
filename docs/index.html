<!-- test -->
<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LXDAO Pods 信息中心</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css">
    <style>
        .dashboard {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .stat-card {
            background: var(--card-background);
            border-radius: 0.75rem;
            padding: 1rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .stat-title {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin: 0;
            font-weight: 500;
        }
        
        .stat-value {
            font-size: 1.25rem;
            color: var(--text-primary);
            font-weight: 600;
            margin: 0;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: repeat(2, 1fr);
            }
            .stat-card:last-child {
                grid-column: span 2;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>LXDAO Pods 信息中心</h1>

        <!-- 统计卡片 -->
        <div class="dashboard">
            <div class="stat-card">
                <h3 class="stat-title">总 Pods 数量</h3>
                <div class="stat-value" id="totalPods">0</div>
            </div>
            <div class="stat-card">
                <h3 class="stat-title">总申请资金</h3>
                <div class="stat-value" id="totalFunding">0 USDT</div>
            </div>
            <div class="stat-card">
                <h3 class="stat-title">平均里程碑金额</h3>
                <div class="stat-value" id="avgMilestoneAmount">0 USDT</div>
            </div>
            <div class="stat-card">
                <h3 class="stat-title">最后更新</h3>
                <div class="stat-value" id="lastUpdate">-</div>
            </div>
        </div>

        <!-- Pods 列表 -->
        <div class="pod-list" id="podList">
            <!-- Pods 将通过 JavaScript 动态加载 -->
        </div>

        <!-- 图表区域 -->
        <div class="chart-container">
            <canvas id="fundingChart"></canvas>
        </div>

        <!-- 里程碑时间线 -->
        <div class="timeline-container">
            <h2>里程碑日程表</h2>
            <div class="timeline" id="milestoneTimeline">
                <!-- 里程碑将通过 JavaScript 动态加载 -->
            </div>
        </div>
    </div>

    <script>
        let podData = null;

        // 加载数据
        async function loadData() {
            try {
                const response = await fetch('./data.json');
                podData = await response.json();
                updateUI();
            } catch (error) {
                console.error('加载数据失败:', error);
            }
        }

        // 更新统计信息
        function updateStats() {
            if (!podData) return;

            // 过滤掉template.md
            const activePods = podData.pods.filter(pod => pod.file !== 'template.md');
            const totalPods = activePods.length;

            document.getElementById('totalPods').textContent = totalPods;
            document.getElementById('totalFunding').textContent = `${podData.stats.total_funding} USDT`;
            document.getElementById('avgMilestoneAmount').textContent =
                `${Math.round(podData.stats.milestone_stats.avg_milestone_amount)} USDT`;
            document.getElementById('lastUpdate').textContent =
                new Date(podData.last_updated).toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
        }

        // 初始化资金分布图表
        function initFundingChart() {
            if (!podData) return;

            // 过滤掉template.md
            const pods = podData.pods.filter(pod => pod.file !== 'template.md');
            const labels = pods.map(pod => pod.basic_info.project_name);
            const data = pods.map(pod => pod.funding.amount);

            new Chart(document.getElementById('fundingChart'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '申请资金 (USDT)',
                        data: data,
                        backgroundColor: '#007bff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Pods 资金申请分布'
                        }
                    }
                }
            });
        }

        // 渲染 Pods 列表
        function renderPodList(pods) {
            const podList = document.getElementById('podList');
            // 过滤掉template.md
            const filteredPods = pods.filter(pod => pod.file !== 'template.md');

            podList.innerHTML = filteredPods.map(pod => {
                const now = new Date();
                const startDate = new Date(pod.timeline.start_date);
                const endDate = new Date(pod.timeline.end_date);

                let status = pod.dev_wg.status;
                let statusClass = '';

                switch (status) {
                    case '初审中':
                        statusClass = 'status-pending';
                        break;
                    case '进行中':
                        statusClass = 'status-ongoing';
                        break;
                    case '已完成':
                        statusClass = 'status-completed';
                        break;
                    case '已延期':
                        statusClass = 'status-delayed';
                        break;
                    case '停滞中':
                        statusClass = 'status-stalled';
                        break;
                    case '已驳回':
                        statusClass = 'status-rejected';
                        break;
                    default:
                        statusClass = 'status-pending';
                }

                return `
                    <div class="pod-card ${statusClass}" onclick="window.location.href='pod-detail.html?name=${encodeURIComponent(pod.basic_info.project_name)}'" style="cursor: pointer;">
                        <div class="pod-header">
                            <div class="pod-title-row">
                                <h2 class="pod-title">${pod.basic_info.project_name}</h2>
                                <span class="pod-status">${status}</span>
                            </div>
                            <div class="pod-meta">
                                <div>负责人: ${pod.basic_info.owner}</div>
                                <div>周期: ${pod.timeline.start_date} 至 ${pod.timeline.end_date}</div>
                                <div>申请金额: ${pod.funding.amount} USDT</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // 渲染里程碑时间线
        function renderMilestoneTimeline() {
            if (!podData) return;

            const timeline = document.getElementById('milestoneTimeline');
            const allMilestones = [];

            // 收集所有里程碑
            podData.pods.forEach(pod => {
                if (pod.file === 'template.md') return;

                pod.milestones.forEach(milestone => {
                    allMilestones.push({
                        date: milestone.date,
                        project: pod.basic_info.project_name,
                        goal: milestone.goal,
                        amount: milestone.amount
                    });
                });
            });

            // 按日期排序
            allMilestones.sort((a, b) => new Date(a.date) - new Date(b.date));

            // 渲染时间线
            timeline.innerHTML = allMilestones.map((milestone, index) => `
                <div class="timeline-item">
                    <div class="timeline-content">
                        <div class="timeline-date">${milestone.date}</div>
                        <div class="timeline-title">${milestone.goal}</div>
                        <div class="timeline-project">${milestone.project}</div>
                        <div class="timeline-amount">${milestone.amount} USDT</div>
                    </div>
                </div>
            `).join('');
        }

        // 更新整个界面
        function updateUI() {
            updateStats();
            initFundingChart();
            renderMilestoneTimeline();
            renderPodList(podData.pods);
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>

</html>